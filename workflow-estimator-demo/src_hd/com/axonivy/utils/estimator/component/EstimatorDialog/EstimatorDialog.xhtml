<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:cc="http://xmlns.jcp.org/jsf/composite"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<cc:interface componentType="IvyComponent">
	<cc:attribute name="dialogWidgetVarId" required="true" />
	<cc:attribute name="updateFormId" />
</cc:interface>
<cc:implementation>

	<p:dialog widgetVar="#{cc.attrs.dialogWidgetVarId}" width="95%" cache="false"
		position="20" header="Workflow Estimator Demo" appendTo="@(body)">
		<h:form id="estimator-dialog-content">
			<p:panelGrid columns="4" layout="flex"
				 columnClasses="col-12 md:col-2 xl:col-3, col-12 md:col-4 xl:col-9, col-12 md:col-2 xl:col-3, col-12 md:col-4 xl:col-9"
				styleClass="customPanelGrid" contentStyleClass="ui-fluid">
				<p:outputLabel for="selectOneProcess" value="Process:" />
				<p:selectOneMenu id="selectOneProcess" converter="pojoConverter"
					value="#{data.workflowEstimatorDemoBean.selectedEstimator.process}">
					<f:selectItem itemLabel="Select process" itemValue="null"
						noSelectionOption="true" />
					<f:selectItems value="#{data.workflowEstimatorDemoBean.processes}"
						var="process" itemLabel="#{process.name}" itemValue="#{process}" />
					<p:ajax event="change" listener="#{logic.onChooseProcess}"
						update="estimator-dialog:estimator-dialog-content:selectOneElement estimator-dialog:estimator-dialog-content:process-viewer-diagram"
						process="@this" />
				</p:selectOneMenu>

				<p:outputLabel for="selectOneElement" value="Start Elements:" />
				<p:selectOneMenu id="selectOneElement" converter="pojoConverter"
					value="#{data.workflowEstimatorDemoBean.selectedEstimator.startElement}">
					<f:selectItem itemLabel="Select elements" itemValue="" />
					<f:selectItems
						value="#{data.workflowEstimatorDemoBean.selectedEstimator.elements}"
						var="element" itemLabel="#{element.name}" itemValue="#{element}" />
				</p:selectOneMenu>

				<p:outputLabel for="SelectOneFindType" value="Find Type:" />
				<p:selectOneMenu id="SelectOneFindType" converter="pojoConverter"
					value="#{data.workflowEstimatorDemoBean.selectedEstimator.findType}">
					<f:selectItem itemLabel="Select find type" itemValue=""
						noSelectionOption="true" />
					<f:selectItems
						value="#{data.workflowEstimatorDemoBean.allFindType}" var="type"
						itemLabel="#{type.findType}" itemValue="#{type}" />
				</p:selectOneMenu>

				<p:outputLabel for="flowName" value="Flow Name:" />
				<p:inputText id="flowName"
					value="#{data.workflowEstimatorDemoBean.selectedEstimator.flowName}" />
			</p:panelGrid>

			<p:outputPanel id="tasks">
				<p:outputLabel value="Estimated Task: " styleClass="text-bold" />
				<p:outputLabel value="#{data.workflowEstimatorDemoBean.selectedEstimator.elementNames}" />
				<br />
				<p:outputLabel value="Total Duration: " styleClass="text-bold" />
				<p:outputLabel value="#{data.workflowEstimatorDemoBean.selectedEstimator.displayTotalDuration}" />
			</p:outputPanel>

			<p:panel id="process-viewer-diagram" header="Process diagram"
				toggleable="true" toggleSpeed="500" closeSpeed="500"
				widgetVar="panel"
				collapsed="#{ data.workflowEstimatorDemoBean.selectedEstimator.processPath eq null ? 'true' : 'false'}">
				<iframe id="process-viewer" style="width: 100%; height: 300px"
					src="#{data.workflowEstimatorDemoBean.selectedEstimator.processPath}" />
			</p:panel>

			<div style="display: flex; float: right; margin-top: 20px">
				<p:commandButton id="generate" actionListener="#{logic.onGenerate}"
					value="Generate" process="@form"
					update="estimator-dialog:estimator-dialog-content:tasks"
					icon="fa-solid fa-check" />

				<p:commandButton id="save-estimator"
					actionListener="#{logic.onSaveEstimator}"
					update="#{cc.attrs.updateFormId}" value="Save Estimator"
					process="@this" icon="fa-solid fa-save"
					oncomplete="PF('estimatorDialog').hide()" />
			</div>
		</h:form>
	</p:dialog>
</cc:implementation>

</html>
