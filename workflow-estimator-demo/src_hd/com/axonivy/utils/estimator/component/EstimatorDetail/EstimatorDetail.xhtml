<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:cc="http://xmlns.jcp.org/jsf/composite"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">
<cc:interface componentType="IvyComponent">
	<cc:attribute name="estimator" required="true" />
	<cc:attribute name="updateId" />
</cc:interface>

<cc:implementation>
	<h:outputStylesheet name="estimator-detail.css" library="ivy-dialog" />
	<c:set var="estimator" value="#{cc.attrs.estimator}" />

	<p:fieldset id="estimator-detail-fieldset"
		legend="Process GUID: #{estimator.process.pid.processGuid}">
		<p:panelGrid columns="6" layout="grid"
			columnClasses="ui-grid-col-2, ui-grid-col-4, ui-grid-col-2, ui-grid-col-4"
			contentStyleClass="ui-fluid">
			<p:outputLabel value="Process: " styleClass="text-bold" />
			<p:outputLabel value="#{estimator.process.name}" />

			<p:outputLabel value="Start Elements: " styleClass="text-bold" />
			<p:outputLabel value="#{estimator.startElement.name}" />

			<p:outputLabel value="Find Type: " styleClass="text-bold" />
			<p:outputLabel value="#{estimator.findType}" />

			<p:outputLabel value="Use case: " styleClass="text-bold" />
			<p:outputLabel value="#{estimator.useCase.name()}" />

			<p:outputLabel value="Flow Name: " styleClass="text-bold" />
			<p:outputLabel value="#{estimator.flowName}" />
            
            <p:outputLabel value="Execution Time: " styleClass="text-bold" />
            <p:outputLabel value="#{estimator.executionTime} miliseconds" />
		</p:panelGrid>

		<p:dataTable value="#{estimator.tasks}" var="task" stripedRows="true"
			resizableColumns="true" rowIndexVar="row"
			styleClass="ui-datatable-sm ui-datatable-gridlines">
			<p:column headerText="#" width="20px">
				<h:outputText value="#{row + 1}" />
			</p:column>

			<p:column headerText="PID">
				<h:outputText value="#{task.shortPid}" title="#{task.pid}" />
			</p:column>

			<p:column headerText="Task Name">
				<h:outputText value="#{task.taskName}" />
			</p:column>

			<p:column headerText="Element Name">
				<h:outputText value="#{task.elementName}" />
			</p:column>

			<p:column headerText="Estimated Duration">
				<h:outputText value="#{task.displayTotalDuration}" />
			</p:column>

			<p:column headerText="Parent Element Names"
				styleClass="text-overflow">
				<h:outputText value="#{task.displayParentElementNames}"
					title="#{task.displayParentElementNames}" />
			</p:column>

			<p:column headerText="Estimated Start Time">
				<h:outputText value="#{task.estimatedStartTimestamp}">
					<f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
				</h:outputText>

			</p:column>
			<p:column headerText="Custom Info">
				<h:outputText value="#{task.customInfo}" />
			</p:column>
		</p:dataTable>

		<p:panel id="process-diagram-#{estimator.id}" header="Process diagram"
			widgetVar="panel-#{estimator.id}" toggleable="true" toggleSpeed="500"
			collapsed="true">

			<iframe id="process-viewer" style="width: 100%; height: 400px"
				src="#{estimator.processPath}" />
		</p:panel>
		<div class="command-btns">
			<p:commandButton id="delete-estimator-#{estimator.id}" value="Delete"
				actionListener="#{logic.deleteEstimator(estimator)}" process="@form"
				update="#{cc.attrs.updateId}" icon="fa-solid fa-remove" />
		</div>

	</p:fieldset>


</cc:implementation>

</html>
